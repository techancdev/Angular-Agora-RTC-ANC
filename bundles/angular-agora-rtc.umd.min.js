!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("agora-rtc-sdk"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-agora-rtc",["exports","@angular/core","agora-rtc-sdk","@angular/common"],t):t(e["angular-agora-rtc"]={},e.ng.core,null,e.ng.common)}(this,function(e,o,r,i){"use strict";var t=function n(){},a=function(){function e(e){this.config=e,this.checkSystemRequirements()?this.getDevices():this.logger("error","Web RTC is not supported")}return e.prototype.checkSystemRequirements=function(){return r.checkSystemRequirements()},e.prototype.getDevices=function(){var i=this;r.getDevices(function(e){var t=e.filter(function(e){return"audioinput"===e.kind&&"default"!==e.deviceId}),o=e.filter(function(e){return"videoinput"===e.kind&&"default"!==e.deviceId});i.audioDevices=t,i.videoDevices=o})},e.prototype.createClient=function(e){void 0===e&&(e="interop"),this.client=r.createClient({mode:e}),this.client.init(this.config.AppID)},e.prototype.createStream=function(e,t,o,i,n,a){return void 0===o&&(o=this.videoDevices[0].deviceId),void 0===i&&(i=this.audioDevices[0].deviceId),r.createStream({streamID:e,audio:t,cameraId:o,microphoneId:i,video:n,screen:a})},e.prototype.logger=function(e,t){switch(e){case"error":r.Logger.error(t);break;case"warning":r.Logger.warning(t);break;case"info":r.Logger.info(t);break;case"debug":r.Logger.debug(t);break;default:r.Logger.error(t)}},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:t,decorators:[{type:o.Inject,args:["config"]}]}]},e.ngInjectableDef=o.defineInjectable({factory:function(){return new e(o.inject("config"))},token:e,providedIn:"root"}),e}(),c=function(){function e(e){this.agoraService=e,this.activeCall=!1,this.audioEnabled=!0,this.videoEnabled=!0,this.remoteCalls=[],this.agoraService.createClient()}return e.prototype.startCall=function(){var t=this;this.activeCall=!0,this.agoraService.client.join(null,"1000",null,function(e){t.localStream=t.agoraService.createStream(e,!0,null,null,!0,!1),t.localStream.setVideoProfile("720p_3"),t.subscribeToStreams()})},e.prototype.subscribeToStreams=function(){var o=this;this.localStream.on("accessAllowed",function(){console.log("accessAllowed")}),this.localStream.on("accessDenied",function(){console.log("accessDenied")}),this.localStream.init(function(){console.log("getUserMedia successfully"),o.localStream.play("agora_local"),o.agoraService.client.publish(o.localStream,function(e){console.log("Publish local stream error: "+e)}),o.agoraService.client.on("stream-published",function(e){console.log("Publish local stream successfully")})},function(e){console.log("getUserMedia failed",e)}),this.agoraService.client.on("error",function(e){console.log("Got error msg:",e.reason),"DYNAMIC_KEY_TIMEOUT"===e.reason&&o.agoraService.client.renewChannelKey("",function(){console.log("Renew channel key successfully")},function(e){console.log("Renew channel key failed: ",e)})}),this.agoraService.client.on("stream-added",function(e){var t=e.stream;o.agoraService.client.subscribe(t,function(e){console.log("Subscribe stream failed",e)})}),this.agoraService.client.on("stream-subscribed",function(e){var t=e.stream;o.remoteCalls.includes("agora_remote"+t.getId())||o.remoteCalls.push("agora_remote"+t.getId()),setTimeout(function(){return t.play("agora_remote"+t.getId())},2e3)}),this.agoraService.client.on("stream-removed",function(e){var t=e.stream;t.stop(),o.remoteCalls=o.remoteCalls.filter(function(e){return e!=="#agora_remote"+t.getId()}),console.log("Remote stream is removed "+t.getId())}),this.agoraService.client.on("peer-leave",function(e){var t=e.stream;t&&(t.stop(),o.remoteCalls=o.remoteCalls.filter(function(e){return e==="#agora_remote"+t.getId()}),console.log(e.uid+" left from this channel"))})},e.prototype.leave=function(){var e=this;this.agoraService.client.leave(function(){e.activeCall=!1,document.getElementById("agora_local").innerHTML="",console.log("Leavel channel successfully")},function(e){console.log("Leave channel failed")})},e.prototype.toggleAudio=function(){this.audioEnabled=!this.audioEnabled,this.audioEnabled?this.localStream.enableAudio():this.localStream.disableAudio()},e.prototype.toggleVideo=function(){this.videoEnabled=!this.videoEnabled,this.videoEnabled?this.localStream.enableVideo():this.localStream.disableVideo()},e.decorators=[{type:o.Component,args:[{selector:"agora-rtc",template:'<div class="video-container">\n\t<div class="call-container">\n\t</div>\n\t<div class="agora_local">\n\t\t<div class="video-buttons">\n\t\t\t<i class="startCall material-icons" (click)="startCall()" *ngIf="!activeCall">videocam</i>\n\t\t\t<ng-container *ngIf="activeCall">\n\t\t\t\t<i class="endCall material-icons" (click)="leave()" *ngIf="activeCall">phone</i>\n\n\t\t\t\t<i class="mic material-icons" (click)="toggleAudio()" *ngIf="audioEnabled">mic</i>\n\t\t\t\t<i class="mic material-icons" (click)="toggleAudio()" *ngIf="!audioEnabled">mic_off</i>\n\n\t\t\t\t<i class="mic material-icons" (click)="toggleVideo()" *ngIf="videoEnabled">videocam</i>\n\t\t\t\t<i class="mic material-icons" (click)="toggleVideo()" *ngIf="!videoEnabled">videocam_off</i>\n\t\t\t</ng-container>\n\t\t</div>\n\t\t<div id="agora_local"></div>\n\t</div>\n\t<div class="agora_remote" *ngFor="let remote of remoteCalls" [id]="remote">\n\n\t</div>\n</div>',styles:["@import url(https://fonts.googleapis.com/icon?family=Material+Icons);p{font-family:Lato}.video-container{height:100vh;display:flex;flex-wrap:wrap;flex-direction:row;justify-content:center}.agora_local{background-color:#404040;height:250px;width:250px;border:1px solid #000;margin:8px}#agora_local{height:250px;width:250px;top:-28px}.agora_remote{background-color:#404040;height:250px;width:250px;border:1px solid #000;margin:8px}.video-buttons{width:250px;top:210px;position:relative;text-align:center;z-index:999}.video-buttons i{cursor:pointer}.endCall{color:red}.mic,.startCall{color:#fff}"]}]}],e.ctorParameters=function(){return[{type:a}]},e}(),l=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[a,{provide:"config",useValue:e}]}},t.decorators=[{type:o.NgModule,args:[{imports:[i.CommonModule],declarations:[c],exports:[c]}]}],t}(),s=function d(){},u=function g(){},f=function m(){};e.AngularAgoraRtcService=a,e.AgoraLocalComponent=c,e.AngularAgoraRtcModule=l,e.AgoraClient=s,e.Stream=u,e.Device=f,e.AgoraConfig=t,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=angular-agora-rtc.umd.min.js.map